<% include_stylesheet "sidebar" %>
<% sidebar_id = local_assigns.fetch(:sidebar_id, "main") %>
<% hovered = session["sidebar_hovered_#{sidebar_id}".to_sym] == true %>

<% # Log the sidebar state for debugging %>
<% Rails.logger.debug "[Sidebar Template] Rendering sidebar #{sidebar_id} with hovered=#{hovered}" %>

<aside class="sidebar-container" id="<%= sidebar_id %>-sidebar" role="complementary">
  <nav
    class="sidebar <%= 'sidebar-hovered' if hovered %>"
    data-controller="sidebar"
    data-action="mouseenter->sidebar#hover mouseleave->sidebar#unhover"
    data-sidebar-id="<%= sidebar_id %>"
    data-hover="<%= hovered %>"
    data-status="<%= hovered ? 'expanded' : 'collapsed' %>"
    role="navigation"
    aria-label="Navigation Sidebar"
  >
    <div class="sidebar-contents" data-reflex-permanent>
      <% current_path = request.path %>

      <a
        href="/"
        class="sidebar-link <%= 'sidebar-default-cursor' if current_path == '/' %>"
        data-controller="link"
        data-link-is-current-value="<%= current_path == '/' %>"
        data-action="click->link#click"
        aria-label="Go to homepage"
      >
        <%= sidebar_icon(
          "~/images/libreverse-logo.svg",
          current_path == "/" ? "sidebar-current" : "",
        ) %>
      </a>
      <a
        href="/search"
        class="sidebar-link <%= 'sidebar-default-cursor' if current_path == '/search' %>"
        data-controller="link"
        data-link-is-current-value="<%= current_path == '/search' %>"
        data-action="click->link#click"
        aria-label="Go to search page"
      >
        <%= sidebar_icon(
          "~/icons/search.svg",
          current_path == "/search" ? "sidebar-current" : "",
        ) %>
      </a>
      <!-- Authentication links -->
      <% if rodauth.logged_in? %>
        <a
          href="<%= dashboard_path %>"
          class="sidebar-link <%= 'sidebar-default-cursor' if current_path == dashboard_path %>"
          data-controller="link"
          data-link-is-current-value="<%= current_path == dashboard_path %>"
          data-action="click->link#click"
          aria-label="Go to dashboard"
        >
          <%= sidebar_icon(
            "~/icons/dashboard.svg",
            current_path == dashboard_path ? "sidebar-current" : "",
          ) %>
        </a>
        <a
          href="<%= experiences_path %>"
          class="sidebar-link <%= 'sidebar-default-cursor' if current_path == experiences_path %>"
          data-controller="link"
          data-link-is-current-value="<%= current_path == experiences_path %>"
          data-action="click->link#click"
          aria-label="Manage experiences"
        >
          <%= sidebar_icon(
            "~/icons/experiences.svg",
            current_path == experiences_path ? "sidebar-current" : "",
          ) %>
        </a>
        <%= button_to rodauth.logout_path,
            method: :post,
            class: "sidebar-link sidebar-logout-button",
            aria: { label: "Sign out" } do %>
          <%= sidebar_icon("~/icons/logout.svg") %>
        <% end %>
      <% else %>
        <a
          href="<%= rodauth.login_path %>"
          class="sidebar-link <%= 'sidebar-default-cursor' if current_path == rodauth.login_path %>"
          data-controller="link"
          data-link-is-current-value="<%= current_path == rodauth.login_path %>"
          data-action="click->link#click"
          aria-label="Sign in"
        >
          <%= sidebar_icon(
            "~/icons/login.svg",
            current_path == rodauth.login_path ? "sidebar-current" : "",
          ) %>
        </a>
        <a
          href="<%= rodauth.create_account_path %>"
          class="sidebar-link <%= 'sidebar-default-cursor' if current_path == rodauth.create_account_path %>"
          data-controller="link"
          data-link-is-current-value="<%= current_path == rodauth.create_account_path %>"
          data-action="click->link#click"
          aria-label="Sign up"
        >
          <%= sidebar_icon(
            "~/icons/signup.svg",
            current_path == rodauth.create_account_path ? "sidebar-current" : "",
          ) %>
        </a>
      <% end %>
    </div>
  </nav>
</aside>
