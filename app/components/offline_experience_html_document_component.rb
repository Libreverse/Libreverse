# typed: true
# frozen_string_literal: true

class OfflineExperienceHtmlDocumentComponent < Phlex::HTML
  def initialize(experience:, instance_domain:, generated_at:, inline_css:)
    super()
    @experience = experience
    @instance_domain = instance_domain
    @generated_at = generated_at
    @inline_css = inline_css
  end

  def view_template
    doctype

    html(lang: "en") do
      head do
        meta(charset: "UTF-8")
        meta(name: "viewport", content: "width=device-width, initial-scale=1.0")
        title { CGI.escapeHTML(@experience[:title].to_s) }
        style { unsafe_raw(@inline_css) }
      end

      body do
        header do
          h1 { CGI.escapeHTML(@experience[:title].to_s) }
          if @experience[:author].present?
            p { "By: #{CGI.escapeHTML(@experience[:author].to_s)}" }
          end
          p { small { "Downloaded from #{@instance_domain}" } }
        end

        main do
          unsafe_raw(@experience[:content].presence || "<p>Content not available</p>")
        end

        footer do
          hr
          p do
            small do
              plain "This offline experience was generated by LibreVerse email services."
              br
              plain "Original URL: "
              a(href: @experience[:url].to_s) { @experience[:url].to_s }
              br
              plain "Generated: #{@generated_at}"
            end
          end
        end
      end
    end
  end
end
