#!/bin/bash
# Passenger startup script that uses TruffleRuby for the Rails server
# This script ensures Passenger uses TruffleRuby with optimizations

# Switch to TruffleRuby for the server process
source /opt/homebrew/opt/chruby/share/chruby/chruby.sh
source /opt/homebrew/opt/chruby/share/chruby/auto.sh
chruby truffleruby-25.0.0
chruby truffleruby-25.0.0

export USE_TRUFFLERUBY_SERVER=true
bundle > /dev/null 2>&1

# Start Passenger with TruffleRuby
exec bundle exec passenger start "$@"
