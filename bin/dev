#!/usr/bin/env perl
use strict;
use warnings;

# Kill any existing Overmind processes
system('pkill overmind > /dev/null 2>&1');
system('cd .. && perl script/unlock_sqlite.pl > /dev/null 2>&1');

# Attempt to remove the Overmind socket file, ignoring if it doesn't exist
unlink '/tmp/.overmind.sock';

# Set environment variables for Overmind
$ENV{OVERMIND_SOCKET}        = '/tmp/.overmind.sock';
$ENV{OVERMIND_TMUX_CONFIG}   = '/config/overmind-tmux.conf';
$ENV{OVERMIND_RESTART}       = 'all';
$ENV{OVERMIND_COLORS}        = '224,111,150,182,186,147,216,110,174,115,175,116,218,217';
$ENV{OVERMIND_CAN_DIE}       = 'rails-db-creator, startup-message, dragonflydb-detached';

# Start Overmind with the specified process file and any additional arguments
exec 'overmind', 'start', '-f', 'config/dev-processes.yml', @ARGV;