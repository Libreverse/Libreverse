#!/usr/bin/env sh
set -eu

# run project's optimizer; fail on error
printf '%s\n' "Running pre-commit optimizer: bunx socket optimize..."
if ! command -v bunx >/dev/null 2>&1; then
  printf '%s\n' "Error: bunx not found in PATH" >&2
  exit 1
fi

if ! bunx socket optimize; then
  printf '%s\n' "bunx socket optimize failed. Aborting commit." >&2
  exit 1
fi

# stage any changes produced by the optimizer so they're included in the commit
# (this ensures generated/modified files are integrated into the commit)
printf '%s\n' "Staging changes produced by optimizer..."
git add -A

printf '%s\n' "Pre-commit checks complete â€” continuing with commit."