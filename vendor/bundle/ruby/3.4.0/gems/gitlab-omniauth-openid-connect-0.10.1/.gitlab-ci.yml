.test-template: &test
  cache:
    paths:
      - vendor/ruby
  before_script:
    - gem install bundler --no-document
    - bundle config set --local path 'vendor/ruby'
    - bundle install -j $(nproc) --path vendor  # Install dependencies into ./vendor/ruby
    - ruby -v                                   # Print out ruby version for debugging
  script:
    - bundle exec rake test

rspec:
  image: "ruby:${RUBY_VERSION}"
  parallel:
    matrix:
      - RUBY_VERSION: [ "2.6", "2.7", "3.0", "3.1" ]
  <<: *test
