# SQLite configuration for Libreverse
# Uses the enhanced SQLite adapter for better features
default: &default
    adapter: sqlite3
    pool: 1
    pragmas:
        analysis_limit: 0           # No limit on rows analyzed for query optimization
        auto_vacuum: 'INCREMENTAL'  # Enables incremental vacuuming, space reclaimed manually
        automatic_index: 1          # Enables automatic temporary indexes for queries
        busy_timeout: 0             # No waiting for locks (fine for single-threaded)
        cache_size: -200000         # ~200 MB cache to reduce disk I/O
        cache_spill: 1              # Allows spilling dirty pages mid-transaction
        cell_size_check: 1          # Detects oversized cells for corruption checking
        checkpoint_fullfsync: 1     # Ensures durability during checkpoints (Mac OS X)
        foreign_keys: 1             # Enforces foreign key constraints
        fullfsync: 1                # Maximum durability on Mac OS X
        journal_mode: 'WAL'         # Write-Ahead Logging for read-while-write capability
        journal_size_limit: -1      # No limit on WAL journal size
        locking_mode: 'NORMAL'      # Even though it doesn't look like it, it won't work with EXCLUSIVE.
        mmap_size: 200000000        # 200 MB memory-mapped I/O for better read performance
        page_size: 16384            # Larger page size for large datasets
        secure_delete: 'ON'         # Overwrites deleted data for security
        synchronous: 3              # EXTRA mode for highest durability
        temp_store: 2               # Stores temp tables in memory for speed
        wal_autocheckpoint: 1000    # Auto-checkpoints WAL at 1000 pages
        optimize: 1048578            # PRAGMA optimize=0x10002 on connection open

development:
    <<: *default
    database: db/libreverse_development.sqlite3

test:
    <<: *default
    database: db/libreverse_test.sqlite3

production:
    primary:
        <<: *default
        adapter: sqlite3
        database: &production_db "/data/production.sqlite3"
    queue:
        <<: *default
        adapter: sqlite3
        database: *production_db
        migrations_paths: db/queue_migrate
    cache:
        <<: *default
        adapter: sqlite3
        database: *production_db
        migrations_paths: db/cache_migrate
    cable:
        <<: *default
        adapter: sqlite3
        database: *production_db
        migrations_paths: db/cable_migrate