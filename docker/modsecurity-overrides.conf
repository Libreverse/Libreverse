# Project-specific ModSecurity overrides for Libreverse
# Detection phase: enable full audit logging for tuning

# Force audit engine on (even if base file changes later)
SecAuditEngine On
SecAuditLog /var/log/modsec_audit.log

# Reduce noise: skip logging static asset extensions (example)
# SecRule REQUEST_FILENAME "\.(?:gif|jpe?g|png|css|js|ico|woff2?|ttf|map)$" "id:1000001,phase:1,pass,nolog,ctl:auditEngine=Off"

# Placeholder for false-positive suppressions once identified:
# SecRuleUpdateTargetById 942100 !ARGS:q
# SecRuleRemoveById 920350

# Rule Exclusions for /experiences endpoint to handle large HTML uploads
# Exclude specific rules for file parameter on /experiences POST
SecRule REQUEST_URI "@streq /experiences" \
    "id:1001,phase:1,pass,nolog,chain"
SecRule REQUEST_METHOD "@streq POST" \
    "chain"
SecRule ARGS_NAMES "@rx ^file$|^upload$" \
    "ctl:ruleRemoveTargetByTag=attack-xss;ARGS:file"

# Broader exclusion for XSS rules on /experiences
SecRule REQUEST_URI "@streq /experiences" \
    "id:1002,phase:1,pass,nolog,chain"
SecRule REQUEST_METHOD "@streq POST" \
    "ctl:ruleRemoveByTag=attack-xss"

# For chunked upload issues, exclude rule 200004 if needed
# SecRuleRemoveById 200004

# Temporary: Switch to DetectionOnly for tuning (uncomment to enable)
# SecRuleEngine DetectionOnly
